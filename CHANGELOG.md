# 📝 יומן שינויים - Change Log

**קובץ זה מכיל את כל השינויים בפרויקט, מסודרים מהחדש לישן.**

**⚠️ לפני כל שינוי - קרא את הקובץ הזה!**  
**📋 הוראות מפורטות: ראה `CHANGE_WORKFLOW.md`**

---

## 📝 רשימת שינויים (מהחדש לישן):

### [2025-11-06] - אופיר ברנס - תיקון טעינת משתמש - הוספת timeout לשאילתות

**מה שונה:**
- עדכון `src/components/AppContext.tsx`
- הוספת timeout של 10 שניות לשאילתות Supabase
- שימוש ב-`Promise.race` כדי למנוע שאילתות תקועות
- שיפור error handling לזיהוי שגיאות timeout

**למה:**
- השאילתה ל-`public.users` לא מחזירה תשובה - השאילתה מתחילה אבל לא מסתיימת
- יכול להיות בעיית רשת או RLS policy חוסמת
- צריך timeout כדי למנוע שאילתות תקועות

**השפעה:**
- ✅ timeout של 10 שניות לשאילתות Supabase
- ✅ error handling טוב יותר לזיהוי שגיאות timeout
- ✅ הודעות שגיאה ברורות יותר למשתמש
- ✅ המערכת לא תקועה על שאילתות תקועות
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - תיקון getUserAPIKey - שימוש ב-import.meta.env במקום process.env

**מה שונה:**
- עדכון `src/components/AppContext.tsx`
- שינוי `getUserAPIKey` להשתמש ב-`import.meta.env.VITE_GEMINI_API_KEY` במקום `process.env.API_KEY`
- Vite מזריק `VITE_*` משתנים דרך `import.meta.env` ב-runtime
- `process.env.API_KEY` מוגדר רק ב-build time (מ-vite.config.ts), לא ב-runtime
- שיפור הלוגיקה כך שה-global API key תמיד זמין מ-`.env.production` דרך `import.meta.env`

**למה:**
- המערכת לא הייתה טוענת משתמשים לאחר השינויים
- `getUserAPIKey` לא מצאה את ה-API key כי חיפשה ב-`process.env.API_KEY` שלא קיים ב-runtime
- צריך להשתמש ב-`import.meta.env.VITE_GEMINI_API_KEY` ב-runtime (Vite מזריק את זה)

**השפעה:**
- ✅ `getUserAPIKey` משתמשת ב-`import.meta.env.VITE_GEMINI_API_KEY` ב-runtime
- ✅ global API key תמיד זמין מ-`.env.production` דרך Vite
- ✅ לוגים מפורטים על בחירת API key
- ✅ המערכת תמיד עובדת גם אם user API key לא זמין
- ✅ תיקון הבעיה של טעינת משתמשים
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - תיקון getUserAPIKey - תמיד תחזיר מפתח תקין

---

### [2025-11-06] - אופיר ברנס - תיקון טעינת משתמש - הסרת retry logic ופישוט קוד

**מה שונה:**
- עדכון `src/components/AppContext.tsx`
- הסרת retry logic מורכבת - חזרה לקוד פשוט יותר שעובד
- שיפור debug logs עם פרטים מפורטים יותר
- תיקון שימוש ב-`finalUserData` במקום `userData` בכל המקומות
- הסרת try-catch כפול

**למה:**
- המערכת לא הייתה טוענת משתמשים לאחר השינויים
- retry logic מורכבת גרמה לבעיות
- צריך לחזור לקוד פשוט יותר שעובד כמו לפני

**השפעה:**
- ✅ קוד פשוט יותר וקל יותר לתחזוקה
- ✅ debug logs מפורטים יותר
- ✅ טעינת משתמשים עובדת כמו לפני השינויים
- ✅ error handling טוב יותר
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - תיקון שגיאות רשת בטעינת משתמש

**מה שונה:**
- עדכון `src/components/AppContext.tsx`
- הוספת retry logic לטעינת נתוני משתמש (3 ניסיונות)
- שיפור error handling לשגיאות רשת (Failed to fetch)
- הוספת הודעות שגיאה מפורטות יותר
- הוספת לוגים מפורטים לניסיונות חיבור

**למה:**
- שגיאה "Failed to fetch" בטעינת נתוני משתמש
- שגיאות רשת לא מטופלות כראוי
- צריך retry logic להתמודד עם בעיות רשת זמניות

**השפעה:**
- ✅ retry logic לטעינת נתוני משתמש (3 ניסיונות)
- ✅ טיפול טוב יותר בשגיאות רשת
- ✅ הודעות שגיאה מפורטות יותר למשתמש
- ✅ לוגים מפורטים לניסיונות חיבור
- ✅ המערכת מתמודדת טוב יותר עם בעיות רשת זמניות
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - תיקון יצירת AI instance בכל פעם

**מה שונה:**
- עדכון `src/components/StoryCreator.tsx`
- עדכון `src/components/WorkbookCreator.tsx`
- עדכון `src/components/AppContext.tsx`
- הסרת יצירת AI instance בפעם הראשונה - יצירה בכל פעם שנוצר תוכן
- שיפור `getUserAPIKey` לנסות מספר דרכים לקבל את ה-API Key
- הוספת לוגים מפורטים לבחירת API Key

**למה:**
- המערכת לא הייתה מייצרת כלום לאחר השינויים
- ה-AI instance נוצר פעם אחת עם API key שלא מתעדכן
- צריך ליצור את ה-AI instance בכל פעם עם ה-API Key הנוכחי

**השפעה:**
- ✅ AI instance נוצר בכל פעם עם ה-API Key הנוכחי
- ✅ משתמשים ב-API Key של המשתמש אם הוא מוגדר
- ✅ Fallback למפתח גלובלי אם משתמש לא מוגדר
- ✅ כל יצירות תוכן (סיפורים, חוברות, תוכניות) עובדות שוב
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - תיקון שימוש ב-API Key של משתמש

**מה שונה:**
- עדכון `src/components/AppContext.tsx`
- עדכון `src/components/StoryCreator.tsx`
- עדכון `src/components/WorkbookCreator.tsx`
- שיפור `getUserAPIKey` להחזיר API Key של משתמש או fallback למפתח גלובלי
- החלפת שימוש ב-`process.env.API_KEY` ב-`getUserAPIKey()` בכל המקומות
- הוספת לוגים מפורטים לבחירת API Key (user-specific או global)

**למה:**
- כאשר מגדירים למשתמש API Key, הוא עדיין היה משתמש במפתח הגלובלי
- צריך להשתמש ב-API Key של המשתמש אם הוא מוגדר, אחרת fallback למפתח גלובלי

**השפעה:**
- ✅ כל משתמש משתמש ב-API Key שלו אם הוא מוגדר
- ✅ Fallback למפתח גלובלי אם משתמש לא מוגדר
- ✅ לוגים מפורטים לבחירת API Key
- ✅ כל יצירות תוכן (סיפורים, חוברות, תוכניות) משתמשות ב-API Key של המשתמש
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - הוספת ניהול API Key לכל משתמש

**מה שונה:**
- עדכון `src/components/AdminDashboard.tsx`
- הוספת הצגת API Key הנוכחי ברשימת המשתמשים
- הוספת אפשרות להגדיר API Key לכל משתמש בחלון פרטי משתמש
- הוספת dropdown בחירת API Key לכל משתמש (רק מפתחות פעילים)
- הוספת הצגת API Key הנוכחי של משתמש ברשימת המשתמשים
- טעינה אוטומטית של API Keys בעת טעינת הדאשבורד

**למה:**
- מאפשר למנהל העל להגדיר API Key ספציפי לכל משתמש
- כל משתמש יכול להשתמש ב-API Key שלו במקום המפתח הגלובלי
- ניהול טוב יותר של מפתחות API במערכת

**השפעה:**
- ✅ מנהל העל יכול להגדיר API Key לכל משתמש בנפרד
- ✅ משתמשים יכולים להשתמש ב-API Key שלהם במקום המפתח הגלובלי
- ✅ הצגת API Key הנוכחי של כל משתמש ברשימת המשתמשים
- ✅ ממשק ניהול ברור ונוח
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - תיקון טעינת משתמש אחרי התחברות

**מה שונה:**
- עדכון `src/components/AppContext.tsx`
- שיפור לוגיקה של יצירת משתמש אוטומטית אם לא קיים ב-`public.users`
- הוספת יצירה ידנית של משתמש אם ה-trigger לא עובד
- הגדרה אוטומטית של super admin privileges עבור `ofirbaranesad@gmail.com`
- שיפור error handling בטעינת משתמש

**למה:**
- המשתמש לא נכנס לפאנל אחרי התחברות
- המשתמש לא נוצר אוטומטית ב-`public.users` אחרי התחברות
- צריך יצירה ידנית אם ה-trigger לא עובד

**השפעה:**
- ✅ משתמשים נוצרים אוטומטית אם לא קיימים
- ✅ Super admin מוגדר אוטומטית עבור `ofirbaranesad@gmail.com`
- ✅ טעינת משתמש יותר יציבה
- ✅ פחות שגיאות בטעינת משתמש
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - החזרת טקסט ב-Hero Section לאישית

**מה שונה:**
- עדכון `src/components/HeroSection.tsx`
- החזרת טקסט ברירת מחדל מ-"פלטפורמת למידה ויצירה מותאמת קבוצתית." ל-"פלטפורמת למידה ויצירה מותאמת אישית."

**למה:**
- החזרת מיקוד להתאמה אישית

**השפעה:**
- ✅ הטקסט משתנה רק אם אין תוכן מותאם אישית (CMS)
- ✅ משפיע על דף הבית (Landing Page) - Hero Section
- ❌ אין breaking changes

---

### [2025-11-06] - מתוקו מסגנאו - החזרת טקסט כותרת Features למקור

**מה שונה:**
- עדכון `src/components/FeaturesSection.tsx`
- שינוי טקסט ברירת מחדל מ-"מה יש לנו להציע?" חזרה ל-"מה אנחנו מציעים?"

**למה:**
- החזרת הטקסט המקורי לפי בקשת המשתמש

**השפעה:**
- ✅ הטקסט משתנה רק אם אין תוכן מותאם אישית (CMS)
- ✅ משפיע על דף הבית (Landing Page)
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - שינוי טקסט ב-Hero Section

**מה שונה:**
- עדכון `src/components/HeroSection.tsx`
- שינוי טקסט ברירת מחדל מ-"פלטפורמת למידה ויצירה מותאמת אישית." ל-"פלטפורמת למידה ויצירה מותאמת קבוצתית."

**למה:**
- שינוי מיקוד מהתאמה אישית להתאמה קבוצתית

**השפעה:**
- ✅ הטקסט משתנה רק אם אין תוכן מותאם אישית (CMS)
- ✅ משפיע על דף הבית (Landing Page) - Hero Section
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - עדכון תהליך עבודה עם Pull מחייב

**מה שונה:**
- עדכון `CHANGE_WORKFLOW.md` - תהליך עבודה מחייב עם Pull לפני כל שלב
- עדכון `README.md` - תהליך עבודה מחייב עם Pull
- עדכון `CURSOR_PROJECT_GUIDE.md` - Checklist מעודכן עם Pull
- הוספת כללים מחייבים: Pull לפני שינוי + Pull לפני Commit
- הוספת אזהרות חזקות על Pull לפני כל שלב
- הוספת Checklist מלא לפני כל שלב

**למה:**
- סנכרון מלא בין שני המשתמשים
- מניעת קונפליקטים בין שינויים
- וידוא שהמערכת תמיד מעודכנת
- תהליך עבודה מסודר ומחייב

**השפעה:**
- ✅ תהליך עבודה מחייב: Pull → קרא → שנה → תעד → Pull → Commit → Push
- ✅ פחות קונפליקטים בין שינויים
- ✅ סנכרון מלא בין שני המשתמשים
- ✅ כללי עבודה מחייבים וברורים
- ⚠️ **חובה Pull לפני כל שינוי!**
- ⚠️ **חובה Pull לפני כל Commit!**
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - שינוי טקסט בכותרת Features

**מה שונה:**
- עדכון `src/components/FeaturesSection.tsx`
- שינוי טקסט ברירת מחדל מ-"מה אנחנו מציעים?" ל-"מה יש לנו להציע?"

**למה:**
- שיפור ניסוח הטקסט ליותר טבעי וידידותי

**השפעה:**
- ✅ הטקסט משתנה רק אם אין תוכן מותאם אישית (CMS)
- ✅ משפיע על דף הבית (Landing Page)
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - ארגון מחדש של מערכת התיעוד ושיפור זיהוי משתמש

**מה שונה:**
- יצירת קובץ `CHANGE_WORKFLOW.md` עם כל ההוראות והתהליכים
- עדכון `CHANGELOG.md` - רק רשימת שינויים (בלי הוראות)
- יצירת סקריפטים `get-user-name.ps1` ו-`get-user-name.sh` לזיהוי אוטומטי של משתמש
- עדכון `CURSOR_PROJECT_GUIDE.md` ו-`README.md` להפנות ל-`CHANGE_WORKFLOW.md`
- מערכת זיהוי אוטומטית של משתמש לפי מחשב (COMPUTERNAME/USERNAME)
- עדכון תאריכים לתאריך הנוכחי (2025-11-06)

**למה:**
- סדר וניקיון - הפרדה בין הוראות לשינויים
- זיהוי אוטומטי של משתמש - לא צריך להגדיר ידנית
- תאריכים מדויקים
- קל יותר לניהול - כל סוג מידע בקובץ נפרד

**השפעה:**
- ✅ `CHANGELOG.md` נקי ומסודר כעת (רק שינויים)
- ✅ `CHANGE_WORKFLOW.md` מכיל את כל ההוראות
- ✅ זיהוי אוטומטי של משתמש לפי מחשב
- ✅ סקריפטים לזיהוי משתמש (Windows + Linux/Mac)
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - שינוי טקסט בכותרת Features

**מה שונה:**
- עדכון `src/components/FeaturesSection.tsx`
- שינוי טקסט ברירת מחדל מ-"מה אפשר להציע לך" ל-"מה אנחנו מציעים?"

**למה:**
- שיפור ניסוח הטקסט ליותר מקצועי וידידותי

**השפעה:**
- ✅ הטקסט משתנה רק אם אין תוכן מותאם אישית (CMS)
- ✅ משפיע על דף הבית (Landing Page)
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - תיקון כפילות ב-CHANGELOG

**מה שונה:**
- הסרת כפילות ב-`CHANGELOG.md`
- ניקוי הקובץ מכניסות כפולות

**למה:**
- תיקון שגיאת עריכה

**השפעה:**
- ✅ הקובץ נקי כעת
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - הוספת מערכת תיעוד שינויים מחייבת (2 משתמשים)

**מה שונה:**
- יצירת קובץ `CHANGELOG.md` לתיעוד שינויים בזמן אמת
- עדכון `CURSOR_PROJECT_GUIDE.md` עם הוראות מחייבות לתיעוד שינויים
- יצירת `README.md` עם הוראות מחייבות בכניסה לפרויקט
- יצירת `.gitmessage` - Git Commit Template להזכרת תיעוד
- הוספת תהליך עבודה מחייב: קריאת CHANGELOG לפני כל שינוי + תיעוד לפני כל Commit
- הגדרת Git Commit Template

**למה:**
- שני משתמשים עובדים על הפרויקט (אופיר ברנס ומתוקו מסגנאו)
- צריך לדעת מה שונה, על ידי מי, ולמה
- צריך למנוע התנגשויות בין שינויים
- צריך מערכת תיעוד חזקה ומחייבת

**השפעה:**
- ✅ כל שינוי מתועד כעת
- ✅ שני המשתמשים יכולים לראות שינויים בזמן אמת
- ✅ פחות התנגשויות בין שינויים
- ⚠️ **חובה לקרוא CHANGELOG לפני כל שינוי!**
- ⚠️ **חובה לתיעד ב-CHANGELOG לפני כל Commit!**

---

### [2025-11-06] - אופיר ברנס - תיקון API Key loading

**מה שונה:**
- עדכון `vite.config.ts` לקריאת `VITE_GEMINI_API_KEY` מ-`.env.production`
- עדכון `deploy-vite-project.sh` ליצירת `.env.production` לפני Build
- הוספת debug logging ב-`StoryCreator.tsx` ו-`WorkbookCreator.tsx`

**למה:**
- API Key לא נטען נכון ב-Production
- Vite לא קרא את משתני הסביבה ב-Build time

**השפעה:**
- ✅ API Key נטען נכון כעת
- ✅ צריך Deploy מחדש
- ❌ אין breaking changes

---

### [2025-11-06] - אופיר ברנס - תיקון Redirect URL אחרי התחברות

**מה שונה:**
- עדכון `LoginModal.tsx` לשימוש בכתובת המלאה (origin + pathname + hash) במקום רק origin
- יצירת `SUPABASE_REDIRECT_FIX.md` עם הוראות לעדכון Supabase Dashboard

**למה:**
- אחרי התחברות, המשתמש הועבר ל-`localhost:3000` במקום לכתובת השרת

**השפעה:**
- ✅ Redirect עובד נכון כעת
- ✅ צריך לעדכן Redirect URLs ב-Supabase Dashboard
- ❌ אין breaking changes

---
